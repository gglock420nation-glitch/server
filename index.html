<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard</title>
    <style>
        :root { --bg: #0f172a; --card: #1e293b; --accent: #3b82f6; --text: #f8fafc; }
        body { font-family: system-ui, sans-serif; background: var(--bg); color: var(--text); max-width: 800px; margin: auto; padding: 20px; }
        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .editor, .note-card { background: var(--card); padding: 20px; border-radius: 12px; border: 1px solid #334155; margin-bottom: 20px; }
        input, textarea, select { width: 100%; background: #0f172a; border: 1px solid #334155; color: #fff; padding: 10px; border-radius: 6px; margin-bottom: 10px; box-sizing: border-box; }
        .btn-main { background: var(--accent); color: #fff; border: none; padding: 12px; border-radius: 6px; cursor: pointer; width: 100%; font-weight: bold; }
        .btn-backup { background: #475569; width: auto; padding: 8px 15px; font-size: 13px; margin-top: 10px; }
        .search-bar { border: 2px solid var(--accent); }
        .note-card { position: relative; border-top: 4px solid var(--accent); animation: slide 0.3s ease; }
        @keyframes slide { from { opacity:0; transform:translateY(10px); } to { opacity:1; } }
        .delete-ico { position: absolute; top: 10px; right: 10px; color: #f87171; cursor: pointer; }
        .tag { display: inline-block; padding: 2px 10px; border-radius: 12px; font-size: 10px; font-weight: 800; text-transform: uppercase; margin-bottom: 5px; }
        .tag-work { background: #ef4444; } .tag-study { background: #10b981; } .tag-other { background: #64748b; }
        .note-content a { color: var(--accent); text-decoration: underline; }
    </style>
</head>
<body>
    <div class="header">
        <h1>üöÄ Dashboard</h1>
        <div>
            <div id="status" style="font-size: 12px; text-align: right;">‚óè Online</div>
            <button class="btn-main btn-backup" onclick="downloadBackup()">üíæ –ë—ç–∫–∞–ø TXT</button>
        </div>
    </div>
    <div class="editor">
        <input id="title" placeholder="–ó–∞–≥–æ–ª–æ–≤–æ–∫..."><textarea id="content" placeholder="–¢–µ–∫—Å—Ç..." rows="3"></textarea>
        <select id="category"><option>–†–∞–∑–Ω–æ–µ</option><option>–†–∞–±–æ—Ç–∞</option><option>–£—á–µ–±–∞</option></select>
        <button class="btn-main" onclick="add()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∑–∞–º–µ—Ç–∫—É</button>
    </div>
    <input id="search" class="search-bar" placeholder="–ü–æ–∏—Å–∫ –ø–æ –∑–∞–≥–æ–ª–æ–≤–∫–∞–º –∏ —Ç–µ–∫—Å—Ç—É..." oninput="render()">
    <div id="list"></div>

    <script>
        const API = "https://my-mega-notes.onrender.com"; // –£–±–µ–¥–∏—Å—å, —á—Ç–æ —Ç—É—Ç —Ç–≤–æ–π URL –æ—Ç Render
        const get = id => document.getElementById(id);
        let notes = [];

        const toast = (m, e) => {
            const t = document.createElement('div'); t.textContent = m;
            t.style.cssText = `position:fixed;bottom:20px;right:20px;background:${e?'#ef4444':'#10b981'};color:#fff;padding:10px 20px;border-radius:8px;z-index:1000;box-shadow:0 4px 10px rgba(0,0,0,0.3);`;
            document.body.append(t); setTimeout(() => t.remove(), 2500);
        };

        const linkify = t => t.replace(/(\b(https?):\/\/[-A-Z0-9+&@#\/%?=~_|!:,.;]*[-A-Z0-9+&@#\/%=~_|])/ig, '<a href="$1" target="_blank">$1</a>');
        const getCls = c => ({'—Ä–∞–±–æ—Ç–∞':'tag-work','—É—á–µ–±–∞':'tag-study'}[c?.toLowerCase()] || 'tag-other');

        async function load() {
            try { 
                const r = await fetch(`${API}/notes/`); 
                notes = await r.json(); 
                render(); 
                get('status').style.color = "#10b981"; 
            } catch { 
                get('status').innerHTML = "‚óè Offline"; get('status').style.color = "#ef4444"; 
            }
        }

        function render() {
            const q = get('search').value.toLowerCase();
            get('list').innerHTML = notes.filter(n => (n.title + n.content + (n.category||'')).toLowerCase().includes(q)).reverse().map(n => `
                <div class="note-card">
                    <b class="delete-ico" onclick="del(${n.id})">‚úñ</b>
                    <div class="tag ${getCls(n.category)}">${n.category || '–†–∞–∑–Ω–æ–µ'}</div>
                    <div style="font-size:11px;color:#94a3b8">${n.created_at}</div>
                    <h3>${n.title}</h3><p class="note-content" style="white-space:pre-wrap">${linkify(n.content||'')}</p>
                </div>`).join('');
        }

        async function add() {
            const t = get('title'), c = get('content'), cat = get('category');
            if(!t.value) return toast("–ó–∞–≥–æ–ª–æ–≤–æ–∫ –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω!", 1);
            await fetch(`${API}/notes/`, {
                method:'POST', 
                headers:{'Content-Type':'application/json'}, 
                body:JSON.stringify({title:t.value, content:c.value, category:cat.value})
            });
            t.value = c.value = ''; toast("‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–æ"); load();
        }

        async function del(id) { 
            if(confirm("–£–¥–∞–ª–∏—Ç—å?")) { 
                await fetch(`${API}/notes/${id}`, {method:'DELETE'}); 
                toast("üóëÔ∏è –£–¥–∞–ª–µ–Ω–æ"); load(); 
            } 
        }

        async function downloadBackup() {
            try {
                const r = await fetch(`${API}/export`);
                const blob = await r.blob();
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url; a.download = "notes_backup.txt";
                document.body.appendChild(a); a.click(); a.remove();
                toast("üíæ –§–∞–π–ª —Å–∫–∞—á–∞–Ω");
            } catch { toast("‚ùå –û—à–∏–±–∫–∞ –±—ç–∫–∞–ø–∞", 1); }
        }

        window.onload = load;
    </script>
</body>
</html>